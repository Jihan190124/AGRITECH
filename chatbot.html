<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>AgriTech Bot</title>
<style>
  :root {
    --primary-color: #4F200D;
    --secondary-color: #FFD93D;
    --accent-color: #FF9A00;
    --background-color: #F6F1E9;
    --card-background: #ffffff;
    --text-color: #212121;
    --light-text-color: #757575;
    --border-color: #e0e0e0;
  }
  body{font-family:Arial, sans-serif; margin:0; padding:0; background:var(--background-color); color:var(--text-color);}
  header{background:var(--primary-color); color:white; padding:12px; text-align:center; font-weight:bold;}
  #chat{height:70vh; overflow-y:auto; padding:15px; background:var(--card-background);}
  .msg{margin:8px 0; padding:10px; border-radius:8px; max-width:70%;}
  .user{background:var(--secondary-color); margin-left:auto;}
  .bot{margin-right:auto;}
  #controls{display:flex; gap:8px; padding:10px; background:var(--background-color);}
  #input{flex:1; padding:10px; border:1px solid var(--border-color); border-radius:6px;}
  button{padding:10px 16px; border:none; border-radius:6px; background:var(--primary-color); color:white; cursor:pointer;}
  select{padding:8px; border-radius:6px; border:1px solid var(--border-color);}

  .container {
    --uib-size: 45px;
    --uib-color: black;
    --uib-speed: 1.75s;
    --uib-bg-opacity: .1;
    height: 31.25px;
    width: 50px;
    transform-origin: center;
    overflow: visible;
  }

  .car {
    stroke: var(--uib-color);
    stroke-dasharray: 100;
    stroke-dashoffset: 0;
    stroke-linecap: round;
    stroke-linejoin: round;
    animation:
      travel var(--uib-speed) ease-in-out infinite,
      fade var(--uib-speed) ease-out infinite;
    will-change: stroke-dasharray, stroke-dashoffset;
    transition: stroke 0.5s ease;
  }

  .track {
    stroke-linecap: round;
    stroke-linejoin: round;
    stroke: var(--uib-color);
    opacity: var(--uib-bg-opacity);
  }

  @keyframes travel {
    0% {
      stroke-dashoffset: 100;
    }

    75% {
      stroke-dashoffset: 0;
    }
  }

  @keyframes fade {
    0% {
      opacity: 0;
    }

    20%,
    55% {
      opacity: 1;
    }

    100% {
      opacity: 0;
    }
  }
</style>
</head>
<body>
  <header>AgriTech Bot</header>

  <div style="padding:8px; background:var(--background-color); text-align:right">
    <label for="lang">Language:</label>
    <select id="lang">
      <option value="en">English</option>
      <option value="hi">Hindi</option>
      <option value="gu">Gujarati</option>
      <option value="mr">Marathi</option>
      <option value="pa">Punjabi</option>
    </select>
  </div>

  <div id="chat"></div>

  <div id="controls">
    <input id="input" placeholder="Type your question...">
    <button onclick="sendMsg()">Send</button>
  </div>

<script>
const API_KEY = "AIzaSyCvCJfO2MtWa2zIPcB0sV1yD66plUAvtrc";
const MODEL_URL = "https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent";

const chat = document.getElementById('chat');
const input = document.getElementById('input');
const langSel = document.getElementById('lang');

function appendMsg(text, who){
  const div = document.createElement('div');
  div.className = 'msg ' + who;
  div.innerText = text;
  chat.appendChild(div);
  chat.scrollTop = chat.scrollHeight;
}

async function sendMsg(){
  const text = input.value.trim();
  if(!text) return;
  appendMsg(text, 'user');
  input.value = '';

  // Add typing indicator
  const typing = document.createElement('div');
  typing.className = 'msg bot';
  typing.innerHTML = '<svg class="container" x="0px" y="0px" viewBox="0 0 50 31.25" height="31.25" width="50" preserveAspectRatio="xMidYMid meet"><path class="track" stroke-width="4" fill="none" pathlength="100" d="M0.625 21.5 h10.25 l3.75 -5.875 l7.375 15 l9.75 -30 l7.375 20.875 v0 h10.25" /><path class="car" stroke-width="4" fill="none" pathlength="100" d="M0.625 21.5 h10.25 l3.75 -5.875 l7.375 15 l9.75 -30 l7.375 20.875 v0 h10.25" /></svg>';
  chat.appendChild(typing);
  chat.scrollTop = chat.scrollHeight;

  // Call Gemini API
  try {
    const lang = langSel.value;
    const prompt = `Answer concisely in one paragraph in ${lang} language. Question: ${text}`;

    const res = await fetch(MODEL_URL + "?key=" + API_KEY, {
      method: "POST",
      headers: {"Content-Type": "application/json"},
      body: JSON.stringify({
        contents: [{ parts: [{ text: prompt }]}]
      })
    });

    const data = await res.json();
    let reply = data?.candidates?.[0]?.content?.parts?.[0]?.text || "No response";

    typing.remove();
    appendMsg(reply, 'bot');
  } catch(err){
    typing.remove();
    appendMsg("Error: " + err.message, 'bot');
  }
}
</script>
</body>
</html>
